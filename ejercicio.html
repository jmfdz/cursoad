<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Formularios - Curso Accesibilidad</title>
  <!-- CSS de Bootstrap 5 desde CDN -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <link
          href="estilos.css"
          rel="stylesheet"
  >
</head>
<body>

  <!-- Barra de navegación (misma que en index.html) -->
  <header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="/">Curso Accesibilidad</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarCurso"
          aria-controls="navbarCurso"
          aria-expanded="false"
          aria-label="Mostrar u ocultar menú"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarCurso">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="formularios.html">Formularios</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="tablas.html">Tablas</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="componentes.html">Componentes</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <!-- Contenido principal -->
  <main>
    <div class="container mt-5">
      <div class="row">
        <div class="col-md-6">
          <p style="font-size:40px;">Formulario de solicitud</h1>

          <!-- Formulario con distintos tipos de campos -->
          <form id="miFormulario" onsubmit="procesarFormulario(event)" enctype="multipart/form-data">
            <!-- Datos del solicitante -->
            <fieldset class="mb-4">
              <legend class="h2">Datos del solicitante</legend>

              <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input
                  type="text"
                  class="form-control"                  
                  name="nombre"
                >
              </div>

              <div class="mb-3">
                <label class="form-label">Apellidos</label>
                <input
                  type="text"
                  class="form-control"
                  id="apellidos"
                  name="apellidos"
                >
              </div>

              <div class="mb-3">
                <label for="dni" class="form-label">DNI</label>
                <input
                  type="text"
                  class="form-control"
                  id="dni"
                  name="dni"
                >
              </div>
            </fieldset>
           

            <!-- Datos de la solicitud -->
            <fieldset class="mb-4">
              <legend>Datos de la solicitud</legend>

              <div class="mb-3">
                <label for="solicita" class="form-label">Solicita</label>
                <textarea
                  class="form-control"
                  id="solicita"
                  name="solicita"
                  rows="3"
                ></textarea>
              </div>
              
            </fieldset>

            <!-- ¿Cómo quieres que te respondamos? -->
            <div class="mb-4">
              <p>¿Cómo quieres que te respondamos?</p>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="resEmail"
                  name="respuesta[]"
                  value="email"
                >
                <label class="form-check-label" for="resEmail">
                  Por e-mail
                </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="resTelefono"
                  name="respuesta[]"
                  value="telefono"
                >
                <label class="form-check-label" for="resTelefono">
                  Por teléfono
                </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="resUACloud"
                  name="respuesta[]"
                  value="uacloud"
                >
                <label class="form-check-label" for="resUACloud">
                  Por UACloud
                </label>
              </div>

                <div class="form-check">
                  <input
                          class="form-check-input"
                          type="checkbox"
                          id="whatsapp"
                          name="respuesta[]"
                          value="whatsapp"
                  >
                  <label class="form-check-label" for="whatsapp">
                    Por whatsapp
                  </label>
                </div>

                  <div class="form-check">
                    <input
                            class="form-check-input"
                            type="checkbox"
                            id="sms"
                            name="respuesta[]"
                            value="sms"
                    >
                    <label class="form-check-label" for="sms">
                      Por SMS
                    </label>
                  
              </div>
            </div>

            <!-- Adjuntar archivo -->
            <div class="mb-3">
              <label for="archivo" class="form-label">
                Adjunta tu DNI en formato imagen (formatos permitidos: png, jpg, jpeg):
              </label>
              <input
                type="file"
                class="form-control"
                id="archivo"
                name="archivo"
              >
              <small id="archivoError" class="text-danger d-none"></small>
            </div>

            <!-- Div para mostrar los errores -->
            <div id="mensajealerta" role="alert"></div>

            <!-- Botón de envío -->
            <button type="submit" class="btn btn-primary">
              Enviar solicitud
            </button>
          </form>
        </div>
        <div class="offset-md-2 col-md-4 mt-5">
          <h3>Sobre la solicitud</h3>
          <div>
            Este formulario es un ejemplo de cómo se pueden implementar formularios accesibles utilizando HTML y Bootstrap 5.
            Asegúrate de completar todos los campos obligatorios antes de enviar el formulario. 
            Este formulario además tiene más contenido y muchos colores más. Veamos unos colores que no sabemos si son accesibles o no....<br/> <span style="color:#FF4D4D;background:#ffffff;">¿Ejemplo de color naranja? ;-)</span>
          </div>
          <p>
            <a href="/">Más información del trámite</a>
          </p>
    </div>
  </main>

  <footer>
    <div class="container my-5">
      <hr/>
      <p>Curso de Accesibilidad - Universidad de Alicante</p>
    </div>
  </footer>

  <!-- JS de Bootstrap 5 desde CDN -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  ></script>

  <!-- Script para manejar el envío del formulario por AJAX -->
  <script>
    let editando = false;

    // Configuración de validación de archivos
    const MAX_BYTES = 10 * 1024 * 1024;            // 10 MB
    const EXT_PERMITIDAS = ['docx', 'pptx', 'pdf']; // extensiones permitidas

    function procesarFormulario(event) {
      // Evita que se haga el envío normal del formulario
      event.preventDefault();

      const formulario = event.target;
      const nombre = formulario.nombre.value.trim();
      const apellidos = formulario.apellidos.value.trim();
      const dni = formulario.dni.value.trim();
      const genero = formulario.querySelector('input[name="genero"]:checked');
      const solicita = formulario.solicita.value.trim();      
      const respuestas = formulario.querySelectorAll('input[name="respuesta[]"]:checked');
      const archivoInput = formulario.archivo;
      const archivo      = archivoInput && archivoInput.files[0];

      // Contenedor para los mensajes de error
      const mensajeAlerta = document.getElementById("mensajealerta");
      mensajeAlerta.classList.remove("alert", "alert-danger");
      mensajeAlerta.textContent = "";

      // Validación simple
      let errores = [];
      if (!nombre) errores.push("El campo 'Nombre' es obligatorio.");
      if (!apellidos) errores.push("El campo 'Apellidos' es obligatorio.");
      if (!dni) errores.push("El campo 'DNI' es obligatorio.");
      if (!genero) errores.push("Debes elegir un género.");
      if (!solicita) errores.push("El campo 'Solicita' es obligatorio.");
      if (respuestas.length === 0) {
        errores.push("Debes seleccionar al menos una forma de respuesta.");
      }

      // Validar el archivo (si se ha seleccionado)
      if (archivo) {
        

        if (archivo.size > MAX_BYTES) {
          errores.push("El archivo supera los 10 MB.");
        }       
      }

      // Si hay errores, los mostramos
      if (errores.length > 0) {
        mensajeAlerta.classList.add("alert", "alert-danger");
        let texto = "<p>Error al enviar el formualrio, se produjeron los siguientes errores:</p><ul>"
        errores.forEach( (error) => {
          texto += "<li>" + error + "</li>";
        })
        texto += "</ul>"
        mensajeAlerta.innerHTML = texto;
      } else {
        // En caso de no haber errores, mostramos un alert de éxito
        alert("¡Enviado! Hacer algo.....");
        // Aquí podrías implementar la lógica real de envío (fetch, axios, etc.)
      }
    }

    document.addEventListener("DOMContentLoaded",(event) => {


      // Agregamos eventos de escucha a todos los inputs, select y textarea
      const inputs = document.querySelectorAll('input, select, textarea');
      inputs.forEach((elem) => {
        elem.addEventListener('input', () => {
          editando = true;
        });
      });

      // Validación inmediata al elegir archivo
      const archivoInputLive = document.getElementById('archivo');
      const archivoErrElem   = document.getElementById('archivoError');
      archivoInputLive?.addEventListener('change', () => {
        archivoErrElem.classList.add('d-none');
        const archivoSel = archivoInputLive.files[0];
        if (!archivoSel) return;

        const ext = archivoSel.name.split('.').pop().toLowerCase();
        const mimeOk = (
          archivoSel.type === 'application/pdf' ||
          archivoSel.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ||
          archivoSel.type === 'application/vnd.openxmlformats-officedocument.presentationml.presentation'
        );

        if (archivoSel.size > MAX_BYTES) {
          archivoErrElem.textContent = 'El archivo supera los 10 MB.';
          archivoErrElem.classList.remove('d-none');
          archivoInputLive.value = '';
        } else if (!EXT_PERMITIDAS.includes(ext) || !mimeOk) {
          archivoErrElem.textContent = 'Solo se permiten archivos .docx, .pptx o .pdf.';
          archivoErrElem.classList.remove('d-none');
          archivoInputLive.value = '';
        }
      });

      // Evento que se dispara al intentar salir de la página
      window.addEventListener('beforeunload', (e) => {
        if (editando) {
          e.preventDefault();
          e.returnValue = 'Hay cambios sin guardar. ¿Estás seguro de que deseas salir?';
        }
      });
    });
  </script>
</body>
</html>